<#-- 
 * description: 角色界面
 * version: 1.0 
 *author:hailin.xu@hand-china.com 
 * #{copyright}# 
 * --> 
<#include "../include/header.html">
<body>
     <script src="${base.contextPath}/common/language?var=languageData" type="text/javascript"></script> 
   <div id="window"></div> 
	<div id="content-container">
		<div id="page-content">
			<div class="panel">
				<form class="form-horizontal">
					<div class="panel-body">

						<!-- roleCode -->
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-3 control-label"><@spring.message "jobdetaildto.jobname"/></label>
								<div class="col-sm-6">
									<input type="text" data-bind="value:model.jobName"
										class="k-textbox">
								</div>
							</div>
						</div>
						<!-- roleCode  end-->

						<!--   roleName -->
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-3 control-label"><@spring.message "jobdetaildto.jobgroup"/></label>
								<div class="col-sm-6">
									<input type="text" data-bind="value:model.jobGroup"
										class="k-textbox">
								</div>
							</div>
						</div>
						<!--   roleName  end -->



						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-3  control-label"><@spring.message "jobrunninginfodto.jobstatus"/></label>
								<div class="col-sm-6">
									<input type="text" data-bind="value:model.jobStatus"
										class="k-textbox">
								</div>
							</div>
						</div>

					</div>
					<!--  panel body end -->
					<!-- -  panel-footer -->

					<div class="panel-footer text-right">
						<span class="btn btn-success" data-bind="click:queryResource"
							type="submit"><@spring.message "hap.query"/></span>
					</div>
					<!-- end panel-footer -->
				</form>
			</div>
			<div class="panel">
				<div class="panel-body">

					<div id="jobGrid" class="table"></div>
				</div>
			</div>
		</div>
	</div>


	<script type="text/javascript">
     
        
        $(document).ready(function () {
        	
       	
          
    	  var viewModel = kendo.observable({
              model:{},
              queryResource: function(e) {
                  $('#jobGrid').data('kendoGrid').dataSource.read();
              }
          });

    	  kendo.bind($('#page-content'),viewModel);
    	  
          var crudServiceBaseUrl = '${base.contextPath}/job/jobinfo/query?sortname=scheduledFireTime&sortorder=desc',
          dataSource = new kendo.data.DataSource({
              transport: {
                 read:  {
                    url: crudServiceBaseUrl,
                    type : "POST",
                    dataType: "json"
                }, 
                parameterMap: function(options) {
                       var model = viewModel.model;
                        var map = {};
                        if(model.jobName)
                       {
                         	 map.jobName=model.jobName;
                       }
                        if(model.jobGroup)
                        {
                        	map.jobGroup=model.jobGroup;
                        }
                        if(model.jobStatus)
                        {
                        	map.jobStatus=model.jobStatus;
                        }
                        if (options.page) 
                        {
                     	 map.page = options.page; 
                        }
                        if (options.pageSize) 
                        {
                         map.pagesize = options.pageSize;
                        }
                        return map;
                }
            },
                batch: true,
                serverPaging : true,
                pageSize: 20,
                schema: {
                    data:'rows',
                    total:'total',
                    model: {
                        id: "jobName",
                        fields: {
                        	jobGroup: {type:"string"},
                        	jobStatus: {type:"string" },
                        	executionSummary: {type:"string"},
                        	previousFireTime: {type:"date" },
                        	scheduledFireTime: {type:"date"},
                        	nextFireTime: {type:"date" },
                        	fireTime: {type:"date"}
                        	
                        }
                    },
                    errors: function(res){
                        if(!res.success && res.message) {
                            return res.message;
                        }
                    }
                }, 
                error: function(e) {
                    alert(e.errors)
                }
            }); 
    
     $("#jobGrid").kendoGrid({
            dataSource: dataSource,
            //width:500,  
            navigatable: true,
            resizable: true,
            scrollable: false,
            editable:false,
            pageable: {
                pageSizes:[5, 10, 20, 50],
                refresh:true,
                buttonCount:5,
                messages: {
                    noRecords: "未找到任何数据",
                    display: "{0} - {1} 共 {2} 条数据",
                    empty: "没有数据",
                    page: "页",
                    of: "/ {0}",
                    itemsPerPage: "条每页",
                    first: "第一页",
                    previous: "前一页",
                    next: "下一页",
                    last: "最后一页",
                    refresh: "刷新"
                }
            },
            columns: [
                { field: "jobName", title: '<@spring.message "jobdetaildto.jobname"/>', width: 180 },
                { field: "jobGroup", title: '<@spring.message "jobdetaildto.jobgroup"/>', width: 180 },
                { field: "jobStatus", title: '<@spring.message "jobrunninginfodto.jobstatus"/>', width: 180,
                  template: function (item) {
                      if (item.jobStatus == 'Finish') {
                          return "<span style='color:green;'>FINISH</span>"
                      }
                      if (item.jobStatus == 'Failed') {
                          return "<span style='color:red;'>FAILED</span>"
                      }
                      if (item.jobStatus == 'Vetoed') {
                          return "<span style='color:orange;'>VETOED</span>"
                      }
                      return item.jobStatus;
                  }
                },
                { field: "executionSummary", title: '<@spring.message "jobrunninginfodto.executionsummary"/>', width: 180},
                { field: "previousFireTime", title: '<@spring.message "jobrunninginfodto.previousfiretime"/>', width: 180 ,
                	template: function(dataItem){
                        var v = dataItem.previousFireTime;
                           if(v instanceof Date){
                      	      return kendo.toString(v,"yyyy-MM-dd hh:mm:ss");
                           }
                     	   return v?v:'';
                      }
                },
                { field:"scheduledFireTime",title:'<@spring.message "jobrunninginfodto.scheduledfiretime"/>',width:180,
                	template: function(dataItem){
                        var v = dataItem.scheduledFireTime;
                           if(v instanceof Date){
                      	      return kendo.toString(v,"yyyy-MM-dd hh:mm:ss");
                           }
                     	   return v?v:'';
                      }
                },
                { field: "nextFireTime", title: '<@spring.message "jobrunninginfodto.nextfiretime"/>', width: 180,
                	template: function(dataItem){
                        var v = dataItem.nextFireTime;
                           if(v instanceof Date){
                      	      return kendo.toString(v,"yyyy-MM-dd hh:mm:ss");
                           }
                     	   return v?v:'';
                      }
                },
                { field: "fireTime", title: '<@spring.message "jobrunninginfodto.firetime"/>', width: 180,
                	template: function(dataItem){
                        var v = dataItem.fireTime;
                           if(v instanceof Date){
                      	      return kendo.toString(v,"yyyy-MM-dd hh:mm:ss");
                           }
                     	   return v?v:'';
                      }
                }      
                ]
        }); 
        
 }); 
</script>
</body>
</html>
