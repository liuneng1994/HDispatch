<#include "../include/head.html">
    <link rel="stylesheet" href="../../../lib/kendoui/styles/kendo.common.min.css" />
    <link rel="stylesheet" href="../../../lib/kendoui/styles/kendo.default.min.css" />
    <link rel="stylesheet" href="../../../lib/kendoui/styles/kendo.default.mobile.min.css" />

    <script src="../../../lib/kendoui/js/jquery.min.js"></script>
    <script src="../../../lib/kendoui/js/kendo.all.min.js"></script>
<body>
<div id='example'>
    <div class='demo-section k-content wide'>
        <div>
            <h2>添加主题</h2>
            <div data-role="grid"
                 data-editable="true"
                 data-toolbar="[{name:'create',text:'新建'},{name:'save',text:'保存'},{name:'cancel',text:'取消'}]"
                 data-columns="[
                                 { 'field': 'themeName','title':'主题名称',validation: { required: true } , 'width': 270,'height':100 },
                                 { 'field': 'description','title':'主题描述', 'width': 270  },
                                 { 'field': 'projectName','title':'项目名称', 'width': 270  },
                                 { 'field': 'projectDescription','title':'项目描述', 'width': 270  },
                              ]"
                 data-bind="source: themes_data,
                            visible: isVisible"
                 style="height: 200px"></div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            var baseUrl = "${base.contextPath}/dispatcher/theme/";
//            var baseUrl = "dispatcher/theme";
            var viewModel = kendo.observable({
                isVisible: true,
                isPageable: true,
                themes_data: new kendo.data.DataSource({
                    schema: {
                        model: {
                            id: 'themeId',
                            fields: {
                                themeName: { type: 'string',validation: { required: true } },
                                description: { type: 'string',validation: { required: true } },
                                projectName: { type: 'string',validation: { required: true } },
                                projectDescription: { type: 'string',validation: { required: true } }
                            }
                        }
                    },
                    batch: true,
                    pageSize: 20,
                    transport: {
                        read: {
                            url: baseUrl+"query",
                            dataType: "json"
                        },
                        create: {
                            url: baseUrl+'submit',
                            type : 'POST',
                            dataType: "json"
                        },
                        parameterMap: function(options, operation) {
                            if (operation !== "read" && options.models) {
//                                alert("进入非read");
                                var datas = options.models;
//                                alert(datas);
//                                alert(datas.themeName);
                                console.log(datas);
                                if(operation =='create' || operation =='update'){
                                    datas = options.models.map(function(data){
                                        data['__status'] = (operation =='create' ? 'add' : 'update');
                                        return data;
                                    });
                                }
                                var data_str = kendo.stringify(datas);
                                console.log(data_str);
                                var map = {
                                    themes_data_array:data_str
                                };
                                return map;
                            } else if (operation === "read") {
//                                alert("进入read");
//                                var map = {
//                                    themeName: '主题名称1',
//                                };
                                var map={};
//                                if (options.page)
//                                    map.page = options.page;
//                                if (options.pageSize)
//                                    map.pageSize = options.pageSize;
//                                for(var k in map){
//                                    if(map[k]==='')delete map[k]
//                                }
                                return map;
                            }
                        }
                    }
                }),
//                pageable: {
//                    refresh: true,
//                    pageSizes: true,
//                    buttonCount: 5
//                }
                pageable: {
                    pageSizes:[5, 10, 20, 50],
                    refresh:true,
                    buttonCount:5,
                    messages: {
                        noRecords: "未找到任何数据",
                        display: "{0} - {1} 共 {2} 条数据",
                        empty: "没有数据",
                        page: "页",
                        of: "/ {0}",
                        itemsPerPage: "条每页",
                        first: "第一页",
                        previous: "前一页",
                        next: "下一页",
                        last: "最后一页",
                        refresh: "刷新"
                    }
                }
            });
            kendo.bind($('#example'), viewModel);
        });

    </script>
</div>
</body>
</html>