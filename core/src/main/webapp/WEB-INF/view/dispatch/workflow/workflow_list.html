<#include "../../include/header.html">
    <script src="../../resources/js/dispatch/config/module.js"></script>
    <script src="../../resources/js/dispatch/controller/workflow/workflowListController.js"></script>
    <script src="../../resources/js/dispatch/service/common/httpService.js"></script>
    <script src="../../resources/js/dispatch/service/workflow/workflowService.js"></script>
    <body ng-app="dispatch" ng-controller="workflowListController as vm">
    <script src="${base.contextPath}/common/language?var=languageData"
            type="text/javascript"></script>
    <div id="tipDelete"></div>
    <div id="dialog"></div>
    <div id="content-container">
        <div id="page-content">

            <div class="panel">
                <form name="flow" novalidate>
                    <div class="panel-body">

                        <div class="row form-horizontal">
                            <div class="panel-body col-sm-offset-0">
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">主题</label>
                                        <div class="col-sm-8 ">
                                            <select class="col-sm-12" name="theme"
                                                    ng-model="vm.workflow.themeId"
                                                    kendo-combo-box
                                                    k-data-text-field="'themeName'"
                                                    k-data-value-field="'themeId'"
                                                    k-data-source="vm.themes"
                                                    style="padding-left:0;padding-right:0"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">层级</label>
                                        <div class="col-sm-8 ">
                                            <select name="layer" class="col-sm-12"
                                                    ng-model="vm.workflow.layerId"
                                                    kendo-combo-box
                                                    k-data-text-field="'layerName'"
                                                    k-data-value-field="'layerId'"
                                                    k-data-source="vm.layers"
                                                    style="padding-left:0;padding-right:0"></select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row form-horizontal">
                            <div class="panel-body col-sm-offset-0">
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">工作流名称</label>
                                        <div class="col-sm-8 ">
                                            <input class="col-sm-12 k-textbox" name="workflowName" workflowName
                                                   ng-model="vm.workflow.workflowName" type="text"
                                                   ng-pattern="'^[a-zA-Z][a-zA-z_0-9]{0,}$'"/>
                                            <span style="color:red;" ng-show="flow.workflowName.$error.pattern">名称必须以字母开始，只能包含字母数字和_</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">工作流描述</label>
                                        <div class="col-sm-8 ">
                                            <input class="col-sm-12 k-textbox" name="description"
                                                   ng-model="vm.workflow.description" type="text"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="panel-footer text-right">
						<span class="btn btn-success" ng-click="vm.search()"
                              type="submit">查询</span>
                    </div>
                </form>
            </div>

            <div class="panel">
                <div class="panel-body">
                    <kendo-grid id="grid" k-options="vm.gridOptions"></kendo-grid>
                </div>
            </div>

        </div>

        <script src="../../lib/dateformat.js"></script>
<!--        <script type="text/javascript">
            var grid;

            function openEditPage(flowId) {
                var dialog = $("#dialog").kendoWindow({
                    actions: ["Maximize", "Minimize", "Close"],
                    width: 920,
                    height: 450,
                    title: schId + ' Scheduled Detail',
                    visible: false,
                    iframe: true,
                    content: 'editpage.html?flowId=' + flowId
                }).data("kendoWindow");
                dialog.center().open();
            }

            $(document)
                    .ready(
                            function () {

                                var viewModel = kendo.observable({
                                    model: {},
                                    queryResource: function (e) {
                                        $('#flowGrid').data('kendoGrid').dataSource
                                                .read();
                                    }
                                });

                                kendo.bind($('#page-content'), viewModel);

                                var crudServiceBaseUrl = '${base.contextPath}/schedule', dataSource = new kendo.data.DataSource(
                                        {
                                            transport: {
                                                read: {
                                                    url: crudServiceBaseUrl
                                                    + "/queryschedule",
                                                    contentType: "application/json",
                                                    type: "GET"
                                                },
                                                parameterMap: function (options,
                                                                        type) {
                                                    if (type === "read") {
                                                        var model = viewModel.model;
                                                        var map = {};
                                                        if (model.flowName) {
                                                            map.flow_id = model.flowName;
                                                        }
                                                        if (model.projectName) {
                                                            map.project_id = model.projectName;
                                                        }
                                                        if (options.page) {
                                                            map.page = options.page;
                                                        }
                                                        if (options.pageSize) {
                                                            map.pagesize = options.pageSize;
                                                        }
                                                        return map;
                                                    } else {
                                                        var datas = options.models;
                                                        return kendo
                                                                .stringify(datas);
                                                    }
                                                }
                                            },
                                            batch: true,
                                            serverPaging: true,
                                            pageSize: 20,
                                            schema: {
                                                data: 'rows',
                                                total: 'total',
                                                model: {
                                                    id: "flowId",
                                                    fields: {
                                                        projectName: {
                                                            type: "string"
                                                        },
                                                        job: {
                                                            type: "string"
                                                        },
                                                        level: {
                                                            type: "string"
                                                        }

                                                    }
                                                },
                                                errors: function (res) {
                                                    if (!res.success && res.message) {
                                                        return res.message;
                                                    }
                                                }
                                            },
                                            error: function (e) {

                                            }
                                        });

                                grid = $("#flowGrid")
                                        .kendoGrid(
                                                {
                                                    dataSource: dataSource,
                                                    //width:500,
                                                    navigatable: true,
                                                    resizable: true,
                                                    reorderable: true,
                                                    scrollable: false,
                                                    editable: false,
                                                    pageable: {
                                                        pageSizes: [5, 10, 20, 50],
                                                        refresh: true,
                                                        buttonCount: 5,
                                                        messages: {
                                                            noRecords: "未找到任何数据",
                                                            display: "{0} - {1} 共 {2} 条数据",
                                                            empty: "没有数据",
                                                            page: "页",
                                                            of: "/ {0}",
                                                            itemsPerPage: "条每页",
                                                            first: "第一页",
                                                            previous: "前一页",
                                                            next: "下一页",
                                                            last: "最后一页",
                                                            refresh: "刷新"
                                                        }
                                                    },
                                                    columns: [
                                                        {
                                                            field: "flowId",
                                                            title: '工作流',
                                                            width: 80
                                                        },
                                                        {
                                                            field: "projectName",
                                                            title: '<@spring.message "工程名"/>',
                                                            width: 200
                                                        },
                                                        {
                                                            field: "job",
                                                            title: '<@spring.message "周期"/>',
                                                            width: 180
                                                        },
                                                        {
                                                            field: "level",
                                                            title: '层',
                                                            width: 180
                                                        },
                                                        {
                                                            field: "",
                                                            title: 'SET SLA ACTION',
                                                            width: 100,
                                                            template: function (item) {
                                                                var html = "<button  class='btn btn-info'onclick='openEditPage(\"" + item.flowId + "\")'"
                                                                        + ">编辑"
                                                                        + "</button>";
                                                                return html;
                                                            }
                                                        }]
                                                }).data("kendoGrid");

                            });
        </script>-->
    </body>
    </html>
