<#-- 
 * description: 角色界面
 * version: 1.0 
 *author:hailin.xu@hand-china.com 
 * #{copyright}# 
 * --> 
<#include "../include/header.html">
<body>
   <div id="window"></div> 
	<div id="content-container">
		<div id="page-content">
			<div class="panel">
				<form class="form-horizontal">
					<div class="panel-body">

						<!-- roleCode -->
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-3 control-label"><@spring.message
									"role.rolecode"/></label>
								<div class="col-sm-6">
									<input type="text" data-bind="value:model.roleCode"
										class="k-textbox">
								</div>
							</div>
						</div>
						<!-- roleCode  end-->

						<!--   roleName -->
						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-3 control-label"><@spring.message
									"role.rolename"/></label>
								<div class="col-sm-6">
									<input type="text" data-bind="value:model.roleName"
										class="k-textbox">
								</div>
							</div>
						</div>
						<!--   roleName  end -->



						<div class="col-sm-6">
							<div class="form-group">
								<label class="col-sm-3  control-label"><@spring.message
									"role.roledescription"/></label>
								<div class="col-sm-6">
									<input type="text" data-bind="value:model.roleDescription"
										class="k-textbox">
								</div>
							</div>
						</div>

					</div>
					<!--  panel body end -->
					<!-- -  panel-footer -->

					<div class="panel-footer text-right">
						<span class="btn btn-success" data-bind="click:queryResource"
							type="submit"><@spring.message "hap.query"/></span>
					</div>
					<!-- end panel-footer -->
				</form>
			</div>
			<div class="panel">
				<div class="panel-body">

					<div id="roleGrid" class="table"></div>
				</div>
			</div>
		</div>
	</div>

	<!-- delete template -->
	<script type="text/x-kendo-template" id="windowTemplate">
       <div> 
          <div class="deleteMessage">
           <span>are you sure delete <strong>#= roleCode #</strong>?</span>
           </div>
        <div class="deleteButton">
            <button class="k-button" id="yesButton">Yes</button>
            <button class="k-button" id="noButton"> No</button>
        </div> 
       </div>
    </script>
	<!-- delete template end -->

	<script type="text/javascript">
     
        
        $(document).ready(function () {
        	
          var windowTemplate = kendo.template($("#windowTemplate").html());
          var window = $("#window").kendoWindow({
               title: "delete",
               visible: false, //the window will not appear before its .open method is called
               width: "250px",
               height: "100px"
     
          }).data("kendoWindow");	
          
    	  var viewModel = kendo.observable({
              model:{},
              queryResource: function(e) {
                  $('#roleGrid').data('kendoGrid').dataSource.read();
              }
          });

    	  kendo.bind($('#page-content'),viewModel);
    	  
          var crudServiceBaseUrl = "${base.contextPath}/sys/role",
              dataSource = new kendo.data.DataSource({
                  transport: {
                     read:  {
                        url: crudServiceBaseUrl + "/query",
                        type : "POST",
                        dataType: "json"
                    },
                    create : { 
                        url : crudServiceBaseUrl + "/submit",
                        contentType: "application/json",
                        type : "POST" 
                    },
                    update : { 
                        url : crudServiceBaseUrl + "/submit",
                        contentType: "application/json",
                        type : "POST" 
                    },
                    destroy : { 
                        url : crudServiceBaseUrl + "/delete",
                        contentType: "application/json",
                        type : "POST" 
                    },
                    parameterMap: function(options, type) {
                        if (type !== "read" && options.models) {
                            var datas = options.models
                            if(type =='create' || type =='update'){
                                datas = options.models.map(function(data){
                                    data['__status'] = (type =='create' ? 'add' : 'update');
                                    return data;
                                })
                            }
                            return kendo.stringify(datas);
                        } else if (type === "read") {
                            var model = viewModel.model;
                      
                            var map = {};
                            if(model.roleCode)
                           {
                             	 map.roleCode=model.roleCode;
                           }
                            if(model.roleName)
                            {
                            	map.roleName=model.roleName;
                            }
                            if(model.roleDescription)
                            {
                            	map.roleDescription=model.roleDescription;
                            }
                            if (options.page) 
                            {
                         	 map.page = options.page; 
                            }
                            if (options.pageSize) 
                            {
                             map.pagesize = options.pageSize;
                            }
                            return map;
                        }  
                    }
                },
                batch: true,
                serverPaging : true,
                pageSize: 20,
                schema: {
                    data:'rows',
                    total:'total',
                    model: {
                        id: "roleCode",
                        fields: {
                             roleName: {validation: { required: true } ,type:"string"},
                             roleDescription: { validation: { required: true } ,type:"string" }
                        }
                    },
                    errors: function(res){
                        if(!res.success && res.message) {
                            return res.message;
                        }
                    }
                },
                error: function(e) {
                    alert(e.errors)
                }
            }); 
    
     var grid =$("#roleGrid").kendoGrid({
            dataSource: dataSource,
            //width:500,
            navigatable: true,
            resizable: true,
            scrollable: false,
            pageable: {
                pageSizes:[5, 10, 20, 50],
                refresh:true,
                buttonCount:5,
                messages: {
                    noRecords: "未找到任何数据",
                    display: "{0} - {1} 共 {2} 条数据",
                    empty: "没有数据",
                    page: "页",
                    of: "/ {0}",
                    itemsPerPage: "条每页",
                    first: "第一页",
                    previous: "前一页",
                    next: "下一页",
                    last: "最后一页",
                    refresh: "刷新"
                }
            },
            toolbar: [{ 
                     name:"create", 
                     text:'<@spring.message "hap.new"/>'
             },{
                     name:"save",
                     text:'<@spring.message "hap.save"/>'  
     
                 },{
                     name:"cancel",
                     text:'<@spring.message "hap.cancel"/>'
                 }
                 ],
            columns: [
                { field: "roleCode", title: '<@spring.message "role.rolecode"/>', width: 180 },
                { field:"roleDescription",title:'<@spring.message "role.roledescription"/>',width:180},
                { field: "roleName", title: '<@spring.message "role.rolename"/>', width: 180},
                {attributes: {style: "text-align:center"}, command : [{

                     text : '<@spring.message "hap.delete"/>',
                  /* tempate: '<span class="btn btn-success"><@spring.message "hap.delete"/></span>',*/
                   click: function(e){
                	   e.preventDefault(); //prevent page scroll reset
                       var tr = $(e.target).closest("tr"); //get the row for deletion
                       var data = this.dataItem(tr); //get the row data so it can be referred later
                       window.content(windowTemplate(data)); //send the row data object to the template and render it
                       window.center().open();

                       $("#yesButton").click(function(){
                           grid.dataSource.remove(data)  //prepare a "destroy" request
                           grid.dataSource.sync()  //actually send the request (might be ommited if the autoSync option is enabled in the dataSource)
                           window.close();
                       });
                       
                       $("#noButton").click(function(){
                           window.close();
                       });
                    } 
                }],width:70}
                ],
           editable: {
            }
        }).data("kendoGrid"); 
        
    }); 
</script>
<style type="text/css">
  .deleteButton{
   
  }
  #yesButton{
      position:absolute; 
      top:50px; 
      left:50px;
      width:50px;
  }
  #noButton{
      position:absolute; 
      top:50px; 
      right:50px;
      width:50px;
  }
  .deleteMessage{
       position:absolute; 
       left:50px;
  }
</style>
</body>
</html>
