<#-- 
* description: lov定义
* version: 1.0 
* 
-->
<#include "../include/header.html">
<body>
    <div id="content-container">
        <div id="page-content">
            <div class="panel col-sm-8" style="padding:0px;">
                <form class="form-horizontal">
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-sm-5">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label"><@spring.message "lov.code"/></label>
                                    <div class="col-sm-9">
                                        <input type="text" data-bind="value:model.code" style="width:100%" class="k-textbox">
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-5">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label"><@spring.message "lov.description"/></label>
                                    <div class="col-sm-9">
                                        <input type="text" data-bind="value:model.description" style="width:100%" class="k-textbox">
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-2">
                                <span class="btn btn-default" data-bind="click:query" type="submit"><@spring.message "hap.query"/></span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="clearfix"></div>
                <div id="grid"></div>
        </div>
    </div>
    <div id="lovDialog"></div>
    <script>
        var viewModel = kendo.observable({
            model:{},
            query: function(e) {
                $('#grid').data('kendoGrid').dataSource.read();
            }
        });
        kendo.bind($('#page-content'),viewModel);
        
        
        function createLov(){
            $('#lovDialog').kendoWindow({
                width: 600,
                height:500,
                modal:true,
                title: "新建Lov",
                content: "sys_kendo_lov_edit.html"
            }).data('kendoWindow').center();
        }
        
        
        var crudServiceBaseUrl = '${base.contextPath}/sys/lov',
        dataSource = new kendo.data.DataSource({
            transport : {
                read : {
                    url: crudServiceBaseUrl + "/query",
                    type : "POST",
                    dataType: "json"
                },
                update : {
                    url : crudServiceBaseUrl + "/submit",
                    contentType: "application/json",
                    type : "POST"
                },
                destroy : {
                    url : crudServiceBaseUrl + "/remove",
                    contentType : "application/json",
                    type : "POST"
                },
                parameterMap: function(options, type) {
                    if (type !== "read" && options.models) {
                        var datas = options.models
                        if (type == 'create' || type == 'update') {
                            datas = options.models.map(function (data) {
                                data['__status'] = (type == 'create' ? 'add' : 'update');
                                return data;
                            })
                        }
                        return kendo.stringify(datas);
                    } else if (type === "read") {
                        var map = viewModel.model.toJSON();
                        map.page = options.page;
                        map.pagesize = options.pageSize;
                        for(var k in map){
                            if(map[k]===''||map[k]===null||map[k]===undefined)
                                delete map[k]
                        }
                        return map;
                    }
                }
            },
            batch : true,
            serverPaging : true,
            pageSize: 10,
            schema: {
                data:'rows',
                total:'total',
                model: {
                    id: "lovId",
                    fields: {
                        code : {editable: true, validation: {required: true}}
                    }
                },
                errors: function(res){
                    if(!res.success && res.message) {
                        return res.message;
                    }
                }
            },
            error: function(e) {
                alert(e.errors)
            }
        });
    
        $("#grid").kendoGrid({
            dataSource: dataSource,
            height:600,
            //resizable: true,
            scrollable: true,
            pageable: {
                pageSizes:[5, 10, 20, 50],
                refresh:true,
                buttonCount:5,
                messages: {
                    noRecords: "未找到任何数据",
                    display: "{0} - {1} 共 {2} 条数据",
                    empty: "没有数据",
                    page: "页",
                    of: "/ {0}",
                    itemsPerPage: "条每页",
                    first: "第一页",
                    previous: "前一页",
                    next: "下一页",
                    last: "最后一页",
                    refresh: "刷新"
                }
            },
            toolbar: [{
                     template: kendo.template('<a style="margin-right:7px;" class="btn btn-default glyphicon glyphicon-plus  k-grid-add" href="javascript:createLov()"><@spring.message "hap.new"/></a>')
                 },{
                     template: kendo.template('<a style="margin-right:7px;" class="btn btn-default glyphicon glyphicon-ok-circle k-grid-save-changes" href="javascript:;"><@spring.message "hap.save"/></a>')
                 },{
                     template: kendo.template('<a class="btn btn-default glyphicon glyphicon glyphicon-remove-circle k-grid-cancel-changes" href="javascript:;"><@spring.message "hap.cancel"/></a>')
                 }],
            columns: [
                { field: "code", title: '<@spring.message "lov.code"/>', width: 300 },
                { field: "description", title: '<@spring.message "lov.description"/>' },
                { title:'<@spring.message "hap.action"/>', width: 150 }
            ],
        	editable: true
        });
    </script>
</body>
</html>
